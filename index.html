<style>
  /* Your existing CSS remains unchanged */
  :root {
    --primary-color: #6366f1;
    --secondary-color: #10b981;
    --background: #ffffff;
    --text-color: #1e293b;
    --dark-bg: #0f172a;
    --dark-text: #f8fafc;
    --error-color: #ef4444;
  }

  /* All previous CSS rules remain same */
</style>

<div class="converter-container">
  <!-- Your existing HTML structure remains unchanged -->
</div>

<script>
  // Fixed JavaScript with working drag & drop
  const elements = {
    dropZone: document.getElementById('dropZone'),
    fileInput: document.getElementById('fileInput'),
    fileList: document.getElementById('fileList'),
    formatOptions: document.getElementById('formatOptions'),
    qualityRange: document.getElementById('qualityRange'),
    sizeRange: document.getElementById('sizeRange'),
    qualityValue: document.getElementById('qualityValue'),
    sizeValue: document.getElementById('sizeValue'),
    convertBtn: document.getElementById('convertBtn'),
    loadingSpinner: document.getElementById('loadingSpinner'),
    errorMessage: document.getElementById('errorMessage'),
    themeToggle: document.getElementById('themeToggle')
  };

  let state = {
    files: [],
    currentFormat: 'png',
    quality: 90,
    size: 100,
    darkMode: false
  };

  // Fixed drag & drop handlers
  elements.dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    elements.dropZone.classList.add('highlight');
  });

  elements.dropZone.addEventListener('dragleave', (e) => {
    e.preventDefault();
    elements.dropZone.classList.remove('highlight');
  });

  elements.dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    elements.dropZone.classList.remove('highlight');
    handleFiles(e.dataTransfer.files);
  });

  elements.fileInput.addEventListener('change', (e) => {
    handleFiles(e.target.files);
  });

  // Rest of the JavaScript remains same
  function handleFiles(files) {
    if (files.length === 0) return;
    
    state.files = [...state.files, ...files];
    updateFileList();
  }

  function updateFileList() {
    elements.fileList.innerHTML = state.files
      .map((file, index) => `
        <div class="file-item">
          <img src="${URL.createObjectURL(file)}" class="file-thumbnail">
          <div>
            <div>${file.name}</div>
            <div>${(file.size / 1024).toFixed(2)} KB</div>
          </div>
        </div>
      `).join('');
  }

  // Remaining functions remain unchanged
  function handleFormatSelect(e) {
    if (!e.target.classList.contains('format-option')) return;
    
    const selected = e.target.dataset.format;
    state.currentFormat = selected;
    
    document.querySelectorAll('.format-option').forEach(option => 
      option.classList.remove('active')
    );
    e.target.classList.add('active');
  }

  function updateQuality() {
    state.quality = elements.qualityRange.value;
    elements.qualityValue.textContent = state.quality;
  }

  function updateSize() {
    state.size = elements.sizeRange.value;
    elements.sizeValue.textContent = state.size;
  }

  async function convertImages() {
    if (state.files.length === 0) {
      showError('Please select at least one image!');
      return;
    }

    elements.loadingSpinner.style.display = 'block';
    elements.errorMessage.style.display = 'none';

    try {
      for (const file of state.files) {
        const converter = new ConvertJS(file);
        const options = {
          quality: state.quality / 100,
          width: file.width * (state.size / 100),
          height: file.height * (state.size / 100)
        };

        const converted = await converter[state.currentFormat](options);
        downloadFile(converted, `${file.name.split('.')[0]}.${state.currentFormat}`);
      }
    } catch (error) {
      showError(`Conversion failed: ${error.message}`);
    } finally {
      elements.loadingSpinner.style.display = 'none';
    }
  }

  function downloadFile(data, filename) {
    const link = document.createElement('a');
    link.href = data;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function showError(message) {
    elements.errorMessage.textContent = message;
    elements.errorMessage.style.display = 'block';
  }

  function toggleTheme() {
    state.darkMode = !state.darkMode;
    document.body.classList.toggle('dark-mode', state.darkMode);
    elements.themeToggle.textContent = state.darkMode ? 'ðŸŒž' : 'ðŸŒ’';
  }
</script>
